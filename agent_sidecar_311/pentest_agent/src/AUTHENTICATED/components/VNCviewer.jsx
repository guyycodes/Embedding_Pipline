import React, { useEffect, useRef } from "react";

export default function VncViewer({ webSocketUrl }) {
  const vncContainerRef = useRef(null);

  useEffect(() => {
    let rfbInstance;
    if (!webSocketUrl || !vncContainerRef.current) return;

    // Dynamically import noVNC so it isnâ€™t pre-bundled by Vite
    import("../../novnc-wrapper")
      .then((module) => {
        // Handle the export (module may not have a default export)
        const RFB = module.default || module;
        rfbInstance = new RFB(vncContainerRef.current, webSocketUrl, {
          // credentials: { password: 'your-vnc-pass' } // if needed
        });
        rfbInstance.viewOnly = false;
        rfbInstance.scaleViewport = true;
        rfbInstance.resizeSession = true;
      })
      .catch((err) => {
        console.error("Error loading noVNC:", err);
      });

    return () => {
      if (rfbInstance) {
        rfbInstance.disconnect();
      }
    };
  }, [webSocketUrl]);

  return (
    <div
      ref={vncContainerRef}
      style={{ width: "100%", height: "100%", background: "black" }}
    />
  );
}
