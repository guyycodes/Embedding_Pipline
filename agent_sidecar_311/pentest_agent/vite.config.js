import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react-swc';
import commonjs from '@rollup/plugin-commonjs';
import path from 'path';

export default defineConfig({
  plugins: [
    react(),
    commonjs({
      requireReturnsDefault: true,
      include: [
        /node_modules\/@novnc/,
        /node_modules\/.*/, 
      ],
      transformMixedEsModules: true,
      dynamicRequireTargets: [
        '**/node_modules/@novnc/novnc/lib/rfb.js'
      ]
    })
  ],
  optimizeDeps: {
    exclude: ['@novnc/novnc'],
    esbuildOptions: {
      define: {
        global: 'globalThis'
      }
    }
  },
  resolve: {
    alias: {
      '@novnc/novnc': path.resolve(__dirname, 'node_modules/@novnc/novnc'),
    }
  }
});